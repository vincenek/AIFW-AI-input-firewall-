<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KnownGPT - Chat with Your Data</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
        #chatbox { width: 100%; height: 400px; border: 1px solid #ccc; padding: 10px; overflow-y: scroll; background: white; margin-bottom: 10px; }
        input[type="text"] { width: 80%; padding: 10px; font-size: 16px; }
        button { padding: 10px 20px; font-size: 16px; }
        .user { color: blue; }
        .bot { color: green; }
    </style>
</head>
<body>
    <h1>KnownGPT</h1>
    <p>Ask anything about the scraped data from <strong>known_data.json</strong></p>
    <div id="chatbox"></div>
    <input type="text" id="userInput" placeholder="Ask a question...">
    <button onclick="processInput()">Send</button>

    <script>
        let data;

        fetch('known_data.json')
            .then(response => response.json())
            .then(json => {
                data = json;
            });

        function processInput() {
            const input = document.getElementById("userInput").value;
            const chatbox = document.getElementById("chatbox");

            chatbox.innerHTML += "<div class='user'><strong>You:</strong> " + input + "</div>";

            let response = generateResponse(input);
            chatbox.innerHTML += "<div class='bot'><strong>KnownGPT:</strong> " + response + "</div>";
            chatbox.scrollTop = chatbox.scrollHeight;
            document.getElementById("userInput").value = "";
        }

        function generateResponse(question) {
            if (!data) return "Data is still loading...";

            question = question.toLowerCase();

            if (question.includes("title")) return "The page title is: " + data.title;
            if (question.includes("description")) return "Description: " + data.meta?.description;
            if (question.includes("keywords")) return "Keywords: " + data.meta?.keywords;
            if (question.includes("url")) return "The URL is: " + data.url;
            if (question.includes("how many links")) return "Link count: " + data.linkCount;
            if (question.includes("how many words")) return "Word count: " + data.wordCount;
            if (question.includes("og") || question.includes("social")) return "Social tags: " + JSON.stringify(data.socialTags);
            if (question.includes("headings")) return "Headings: " + data.headings?.join(", ");
            if (question.includes("images")) return "Image sources: " + data.images?.join(", ");
            if (question.includes("links")) return "Links: " + data.links?.slice(0, 5).join(", ") + "... and more.";
            if (question.includes("text")) return "Here’s some page text: " + data.text?.slice(0, 300) + "...";

            return "Sorry, I couldn’t find an answer to that. Try asking about title, description, url, links, etc.";
        }
    </script>
</body>
</html>
"""

# Save HTML file
output_path = Path("/mnt/data/index.html")
output_path.write_text(html_code)

output_path.name  # Return the file name for user download